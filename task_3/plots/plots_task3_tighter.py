

import os
from pathlib import Path

import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import time

from hmg.models import hbv1d012a_py
from hmg.test import aa_run_model
from hmg import HBV1D012A


def plot_sobol_indices(S_first, S_total):
    parameters = prm_names  # Parameter names

    # Plotting
    x = np.arange(len(parameters))  # The label locations
    width = 0.35  # Width of the bars

    fig, ax = plt.subplots(figsize=(8, 6))
    bars1 = ax.bar(x - width / 2, S_first, width, label='First-order Index')
    bars2 = ax.bar(x + width / 2, S_total, width, label='Total-effect Index')

    # Add some text for labels, title, and custom x-axis tick labels, etc.
    ax.set_xlabel('Parameters')
    ax.set_ylabel('Sobol Indices')
    ax.set_title('Sobol Indices for Sensitivity Analysis - NSE, Global, 50 000 samples')
    ax.set_xticks(x)
    ax.set_xticklabels(parameters)
    plt.xticks(rotation=90)
    ax.legend()

    # Display the plot
    plt.show()

    # Save plot
    fig.savefig(main_dir / 'task_3' / 'plots' / 'sobol_indices_10000_range20_nse', bbox_inches='tight')
prm_names = [
        'snw_dth',
        'snw_ast',
        'snw_amt',
        'snw_amf',
        'snw_pmf',

        'sl0_mse',
        'sl1_mse',

        'sl0_fcy',
        'sl0_bt0',

        'sl1_pwp',
        'sl1_fcy',
        'sl1_bt0',

        'urr_dth',
        'lrr_dth',

        'urr_rsr',
        'urr_tdh',
        'urr_tdr',
        'urr_cst',
        'urr_dro',
        'urr_ulc',

        'lrr_tdh',
        'lrr_cst',
        'lrr_dro',

    ]
S_first_nse_20_50000 = [0.00000000e+00, -1.24467196e-03,  1.90674297e-02, -3.47044132e-03,
4.49522634e-04 , 3.56364193e-02  ,3.77438707e-02 , 0.00000000e+00,
4.16060067e-06,  0.00000000e+00, -5.90296150e-03,  0.00000000e+00,
-2.65930349e-04,  1.20042095e-04, -1.62438500e-04 , 0.00000000e+00,
0.00000000e+00 , 1.25666503e-04 , 0.00000000e+00,  2.25941503e-03,
1.64583801e-05,  1.78147268e-01 , 5.10310372e-01]
S_total_nse_20_50000 = [0.00000000e+00 ,1.03792365e-02, 5.87647605e-02 ,1.83169046e-02,
1.09001537e-03, 9.81017165e-02 ,1.35497801e-01 ,0.00000000e+00,
8.15294030e-06 ,0.00000000e+00 ,7.67105411e-03, 0.00000000e+00,
6.19619128e-05, 3.95551232e-06 ,4.47782488e-05, 0.00000000e+00,
0.00000000e+00, 2.62138071e-06 ,0.00000000e+00, 1.79850025e-03,
1.11144748e-07 ,2.46598717e-01 ,6.17791471e-01
]

S_first_lognse_20_50000 = [ 0.00000000e+00  ,5.06755526e-03 , 5.79725708e-03  ,3.52362919e-03,
3.28764383e-05,  1.82151996e-03, -4.21692118e-03,  0.00000000e+00,
-1.75277563e-04 , 0.00000000e+00,  3.18600025e-04  ,0.00000000e+00,
1.43255299e-04,  1.69738798e-05 ,-2.77494551e-05,  0.00000000e+00,
0.00000000e+00 , 1.00003477e-05 , 0.00000000e+00 , 8.21257183e-04,
1.50638122e-06,  9.28362064e-01 , 5.19231214e-03]

S_total_lognse_20_50000 = [0.00000000e+00, 8.57213424e-03 ,1.32467587e-02, 1.47585932e-03,
1.57060665e-05, 1.59296381e-02 ,1.80557437e-02, 0.00000000e+00,
4.46340206e-05, 0.00000000e+00 ,2.04376684e-03 ,0.00000000e+00,
9.03029077e-05, 1.67625630e-05 ,1.75419001e-06, 0.00000000e+00,
0.00000000e+00, 3.48966076e-08 ,0.00000000e+00 ,8.29184575e-04,
6.25813478e-09, 9.59310727e-01 ,1.20995628e-02
]

S_first_lognse_global_5000 = [-8.70751716e-06 , 1.41633263e-02 , 8.20604268e-04 ,-2.86374071e-04,
-1.46157270e-04,  4.22332780e-03 , 2.54608884e-02,  8.83981231e-04,
1.60814043e-02, -2.13094168e-04,  4.49945728e-02 , 7.94038468e-03,
5.80361594e-06 , 1.41116399e-05 ,-1.86308891e-04 ,-1.98880449e-05,
9.08635016e-07 , 2.06702598e-02  ,0.00000000e+00  ,1.98197913e-03,
1.11305164e-06  ,6.82387628e-01  ,2.67127304e-03]

S_total_lognse_global_5000=  [3.50226360e-04 ,5.89780691e-02 ,1.13651417e-02 ,1.45104817e-03,
2.73178955e-04, 1.89246992e-02, 5.85988326e-02, 8.76808281e-03,
5.17894062e-02 ,3.19161399e-04 ,7.37843021e-02 ,1.53810119e-02,
2.90190353e-06 ,1.64474643e-06, 1.14325790e-04 ,1.10577287e-06,
3.62057703e-07 ,9.61001199e-02, 0.00000000e+00 ,8.69592109e-02,
9.33226636e-09 ,7.89522480e-01 ,2.40479870e-03]

S_first_nse_global_50000= [ 5.74971283e-03,  1.07814712e-02 , 7.78893959e-03 , 6.00532988e-03,
5.89167042e-03,  2.71027129e-02 , 6.45334515e-02 , 1.28356554e-02,
5.19149402e-04 , 7.17065823e-05  ,1.44866914e-01, -1.39778480e-03,
9.57925150e-02  ,4.47346146e-04  ,1.49637118e-04 , 7.76811145e-03,
-1.43198740e-04  ,3.53467556e-01  ,0.00000000e+00 , 1.01166132e-02,
-4.23579471e-07  ,9.72653098e-03  ,3.92911160e-02]
S_total_nse_global_50000 = [1.14812154e-02 ,2.47981806e-02 ,2.53976815e-02, 2.76479065e-02,
2.25813306e-02, 3.83556949e-02 ,9.52832253e-02, 2.46299904e-02,
1.49874885e-03, 8.20514345e-05 ,2.19801321e-01 ,4.31237491e-03,
1.43195072e-01 ,2.39647784e-03, 5.01439725e-03 ,1.59308733e-02,
4.54901170e-03 ,4.57552867e-01 ,0.00000000e+00 ,2.62442727e-02,
6.90295083e-08 ,2.24375470e-02 ,7.15172802e-02]

S_first = S_first_nse_global_50000
S_total = S_total_nse_global_50000
plot_sobol_indices(S_first, S_total)
